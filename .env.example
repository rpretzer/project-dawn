# Project Dawn - Example Environment
# Copy to .env and adjust for your deployment.
#
# IMPORTANT:
# - Do not commit real secrets (JWT_SECRET, API keys).
# - In production, set DAWN_ENV=prod and configure allowed origins.

# ----------------------------
# Runtime mode
# ----------------------------
DAWN_ENV=dev

# ----------------------------
# Realtime server
# ----------------------------
CHAT_HOST=0.0.0.0
CHAT_PORT=8000
CHAT_ALLOWED_ORIGINS=http://localhost:8000
# Require explicit origin allowlist in prod (recommended)
CHAT_REQUIRE_ORIGIN_ALLOWLIST=true
CHAT_ALLOW_GUESTS=true
CHAT_ADMIN_USERNAMES=admin

# ----------------------------
# Observability
# ----------------------------
DAWN_METRICS_ENABLED=true
# In prod, set a secret and pass it as X-Metrics-Token header (or ?token=...).
DAWN_METRICS_TOKEN=change-me-in-prod

# Structured ops log (optional)
DAWN_OPS_LOG_ENABLED=false
DAWN_OPS_DB=data/ops.db
DAWN_OPS_RETENTION_DAYS=14
DAWN_OPS_MAX_EVENTS=5000

# Cookie / session
JWT_SECRET=change-me-in-prod
# Optional: keep old secrets around during a rotation window to avoid logging everyone out
# JWT_OLD_SECRETS=previous-secret-1,previous-secret-2
JWT_TTL_SECONDS=86400
# Access token TTL (default falls back to JWT_TTL_SECONDS if unset). Recommended in prod: 900 (15m).
JWT_ACCESS_TTL_SECONDS=900
# Refresh session TTL. Recommended in prod: 2592000 (30d).
JWT_REFRESH_TTL_SECONDS=2592000
# Lax is ok for dev; consider Strict in prod.
CHAT_COOKIE_SAMESITE=Lax
CHAT_CSRF_COOKIE=dawn_csrf
CHAT_REFRESH_COOKIE=dawn_refresh
# Require double-submit CSRF for browser POSTs (defaults: true in prod, false in dev)
CHAT_REQUIRE_CSRF=true

# Auth DB location (users + refresh sessions + password reset tokens)
DAWN_AUTH_DB=data/users.db
# Secret used to hash refresh/reset tokens (defaults to JWT_SECRET)
# SESSION_TOKEN_SECRET=change-me-in-prod
# Password reset token TTL (seconds)
PASSWORD_RESET_TTL_SECONDS=3600
# In dev, return reset token in response (prod always hides it)
DAWN_RETURN_RESET_TOKEN=true

# Admin hardening (optional)
CHAT_ADMIN_ALLOWED_IPS=127.0.0.1
CHAT_ADMIN_REQUIRE_MTLS=false
CHAT_MTLS_VERIFY_HEADER=X-Client-Verify
CHAT_MTLS_VERIFY_VALUE=SUCCESS

# Require an additional token for risky admin actions (patch apply, moderation commands, admin user changes)
CHAT_REQUIRE_ADMIN_ACTION_TOKEN=true
CHAT_ADMIN_ACTION_TOKEN=change-me-in-prod

# Optional: override default CSP (if you host your own UI)
# CHAT_CSP=default-src 'self'; connect-src 'self' wss:; style-src 'self'; script-src 'self'

# Rate limits
CHAT_MAX_MSGS_PER_10S_HUMAN=12
CHAT_MAX_MSGS_PER_10S_GUEST=6
CHAT_MAX_AUTH_PER_MINUTE=10

# WS action rate limits (task create / rating)
CHAT_MAX_TASKS_PER_MINUTE_HUMAN=8
CHAT_MAX_TASKS_PER_MINUTE_GUEST=2
CHAT_MAX_RATINGS_PER_MINUTE=20

# ----------------------------
# Agent workspace + tools
# ----------------------------
DAWN_WORKSPACE_ROOT=/workspace

# Allow agents to APPLY patches directly? (recommended: false)
DAWN_ALLOW_AGENT_PATCH_APPLY=false

# Allow patch paths (unified diffs) for fs_apply_patch checks
DAWN_PATCH_PREFIXES=core/,interface/,systems/,plugins/,tests/,README.md,ROADMAP.md,requirements.txt,artifacts/

# Allow UI artifact reads + patch apply
CHAT_FILE_READ_PREFIXES=artifacts/
CHAT_PATCH_APPLY_PREFIXES=artifacts/

# Read-only git diff in UI (admin panel)
CHAT_GIT_DIFF_PREFIXES=artifacts/

# Safe HTTP allowlist for http_get/http_get_json
DAWN_HTTP_ALLOWED_HOSTS=raw.githubusercontent.com,api.github.com

# ----------------------------
# Auto-evolution (optional)
# ----------------------------
AUTO_EVOLUTION=false
AUTO_EVOLUTION_INTERVAL_SECONDS=60
AUTO_EVOLUTION_MIN_TASKS_TO_START=5
AUTO_EVOLUTION_MIN_TASKS_AFTER=5
AUTO_EVOLUTION_REGRESSION_THRESHOLD=0.08

# ----------------------------
# LLM provider (example)
# ----------------------------
LLM_PROVIDER=ollama
OLLAMA_URL=http://host.docker.internal:11434
OLLAMA_MODEL=llama3

